---
title: websocket
date: 2018-03-01 14:24:56
tags:
---
说起websocket，还有一段过不去的梗。
临近毕业那会儿出来杭州面试，面试官（我现在的leader，人超nice的）拿着手机看着网页上实时波动的数据，问我，你知道这个是怎么实现的嘛，刷接口(俗称ajax轮询)啊，写个定时器，不停地刷接口，从而拿到接口返回数据。紧接着，又问了句，你知道websocket么，我想都不带想的，缓存啊，哈哈哈，到现在还是个过不去的梗~（笑哭，捂脸）

年后刚好不忙，新项目还在筹备阶段，刚好整理下

言归正传
说起websocket会想到http,长连接和短链接

1. websocket是什么
    实质上来说websocket是基于TCP的协议。
2. 应用场景

3. 为什么不采用基于http协议的接口轮询

4. 二者有什么区别和联系

5. 如何创建一个websocket，以及其基本事件有哪些，什么是心跳，心跳用来解决什么问题

6. websocket在项目中遇到的问题，以及解决方案
    h5网页通常打包在客户端，和交易相关，数据实时变化，存在一个问题是，当页面停留在当前页面的时候，手机app进程退至后台，然后websocket会断掉

    针对外汇业务，整个项目只创建了一个websocket，和服务端约定不同的code来处理不同的业务逻辑

    外汇项目难点：
    1. 整个项目多处用到websocet，订阅全部行情，订阅单个行情，获取账户资金信息，下单，多终端登录数据同步等问题
    2. 和客户端联调
    3. 环境部署
    4. 运营活动与业务逻辑
    5. webview升级缓存问题（不常见）
    6. 客户端唤醒出现未登录问题
    7. 本地存储代理商信息pcode和sign
    8. app休眠唤醒后socket断开连接，不会触发重连，只能杀掉进程
    9. 首页轮播自动播放速度会受到socket的影响
    10. 微信适配
    11. 活动弹窗



    在过产品原型，设计定初稿的时候，就要问清楚，当前产品应用场景主要用在手机浏览器（通常不会），微信，手机app内部
    要考虑一些微信和手机app打开不同的场景，比如微信会出现双头部，功能不要放在头部等

